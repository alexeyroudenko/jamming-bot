<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jamming bot — Phrases</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000;
      color: #fff;
      font-family: "Lucida Grande", "Droid Sans", Arial, Helvetica, sans-serif;
      width: 100vw;
      min-height: 100vh;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 12px 20px;
      font-size: 11px;
      color: #666;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      background: rgba(0,0,0,.85);
    }
    nav a { color: #555; text-decoration: none; margin-right: 12px; }
    nav a:hover { color: #fff; }
    #status { color: #333; font-size: 10px; }

    #phrases {
      padding: 48px 20px 20px;
      column-count: 3;
      column-gap: 24px;
    }

    @media (max-width: 900px) { #phrases { column-count: 2; } }
    @media (max-width: 560px) { #phrases { column-count: 1; } }

    .phrase {
      display: inline-block;
      width: 100%;
      padding: 6px 12px;
      margin-bottom: 6px;
      border-radius: 4px;
      font-size: 14px;
      color: #aaa;
      background: #111;
      border-left: 3px solid #1a3a4a;
      transition: border-color 0.2s, color 0.2s;
      break-inside: avoid;
    }
    .phrase:hover {
      color: #fff;
      border-left-color: #00ffcc;
    }

    #loading {
      text-align: center;
      padding: 120px 20px;
      color: #333;
      font-size: 14px;
    }
    #loading .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #333;
      border-top-color: #00ffcc;
      border-radius: 50%;
      animation: spin .8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<nav>
  <div>
    <a href="/">← home</a>
    <a href="/tags/">tag cloud</a>
  </div>
  <span id="status"></span>
</nav>

<div id="loading"><span class="spinner"></span> generating phrases from tags…</div>
<div id="phrases"></div>

<script>
(function () {
  var TAGS_API = '/api/tags/get/';
  var COMBINE_API = '/api/tags/combine/';
  var REFRESH_INTERVAL = 60000;
  var statusEl = document.getElementById('status');
  var phrasesEl = document.getElementById('phrases');
  var loadingEl = document.getElementById('loading');

  function fetchPhrases() {
    statusEl.textContent = 'fetching tags…';
    fetch(TAGS_API)
      .then(function (r) { return r.json(); })
      .then(function (tags) {
        if (!tags || !tags.length) {
          statusEl.textContent = 'no tags';
          loadingEl.style.display = 'none';
          return;
        }

        tags.sort(function (a, b) { return b.count - a.count; });
        var words = tags.map(function (t) { return t.name; });

        statusEl.textContent = 'combining ' + words.length + ' tags…';

        return fetch(COMBINE_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ words: words, limit: 50, max_phrases: 2048 })
        });
      })
      .then(function (r) { if (r) return r.json(); })
      .then(function (data) {
        if (!data) return;
        loadingEl.style.display = 'none';

        if (data.error) {
          statusEl.textContent = 'error: ' + data.error;
          return;
        }

        renderPhrases(data.phrases || []);
        statusEl.textContent = data.count + ' phrases';
      })
      .catch(function (err) {
        console.error(err);
        loadingEl.style.display = 'none';
        statusEl.textContent = 'error';
      });
  }

  function renderPhrases(phrases) {
    phrasesEl.innerHTML = '';
    for (var i = 0; i < phrases.length; i++) {
      var el = document.createElement('div');
      el.className = 'phrase';
      el.textContent = phrases[i];
      phrasesEl.appendChild(el);
    }
  }

  fetchPhrases();
  setInterval(fetchPhrases, REFRESH_INTERVAL);
})();
</script>

</body>
</html>
